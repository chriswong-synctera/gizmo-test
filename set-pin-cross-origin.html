<!-- EXAMPLE HTML: Showing how to use the <set-pin> component -->
<!-- This won't be used in prod by any partner, but is used for development and testing -->

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Set PIN Widget</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon" />
    <script
      data-dev-only
      src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"
    ></script>
    <script data-dev-only src="../node_modules/lit/polyfill-support.js"></script>
    <script type="module" src="https://assets-staging.synctera.com/widgets/set-pin/v1.0.1/index.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 0;
        margin: 0;
        min-height: 100vh;
        background: #f5f5f5;
      }

      .test-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }

      .test-section {
        margin: 20px 0;
        padding: 20px;
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .test-section h3 {
        margin-top: 0;
        color: #1f2937;
      }

      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #3b82f6;
        text-decoration: none;
        font-weight: 500;
      }

      .back-link:hover {
        text-decoration: underline;
        color: #2563eb;
      }

      h1 {
        color: #1f2937;
        margin-bottom: 10px;
      }

      .description {
        color: #6b7280;
        margin-bottom: 20px;
      }

      /* Token configuration styles */
      .token-config-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 12px;
      }

      .token-label {
        font-weight: 600;
        color: #374151;
        font-size: 14px;
      }

      .token-input {
        padding: 12px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        background: #ffffff;
        color: #1f2937;
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        font-size: 14px;
        transition: all 0.2s ease;
        outline: none;
      }

      .token-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .theme-selector {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      .theme-btn {
        padding: 8px 16px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .theme-btn:hover {
        border-color: #3b82f6;
      }

      .theme-btn.active {
        border-color: #3b82f6;
        background: #eff6ff;
        color: #3b82f6;
      }

      /* Widget container */
      .widget-container {
        margin-top: 16px;
      }

      /* Event log styles */
      .event-log {
        margin-top: 16px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 8px;
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }

      .event-log-entry {
        padding: 4px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .event-log-entry:last-child {
        border-bottom: none;
      }

      .event-log-time {
        color: #6b7280;
      }

      .event-log-type {
        color: #3b82f6;
        font-weight: 600;
      }

      .event-log-success {
        color: #10b981;
      }

      .event-log-failure {
        color: #ef4444;
      }

      /* Night shift theme preview */
      .night-shift-preview {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        padding: 20px;
        border-radius: 12px;
      }
    </style>
  </head>

  <body>
    <div class="test-container">
      <a href="../index.html" class="back-link">‚Üê Back to Widget Index</a>

      <h1>Set PIN Widget</h1>
      <p class="description">
        The new consolidated Set PIN widget using the MessageBus/IframeManager architecture. This
        widget provides a complete PIN entry form with validation and PIN match checking.
      </p>

      <div class="test-section">
        <h3>Configuration</h3>
        <div class="token-config-container">
          <label for="widgetToken" class="token-label">Widget Token:</label>
          <input
            type="text"
            id="widgetToken"
            class="token-input"
            placeholder="Paste your widget token here"
            value="test-token-123"
          />
        </div>

        <div class="token-label" style="margin-top: 12px">Theme:</div>
        <div class="theme-selector">
          <button class="theme-btn active" data-theme="default">Default</button>
          <button class="theme-btn" data-theme="night-shift">Night Shift</button>
        </div>
      </div>

      <div class="test-section">
        <h3>Widget Demo</h3>
        <div id="widget-container" class="widget-container">
          <set-pin
            id="set-pin"
            token="test-token-123"
            env="staging"
            theme="default"
          ></set-pin>
        </div>
      </div>

      <div class="test-section">
        <h3>Event Log</h3>
        <div id="event-log" class="event-log">
          <div class="event-log-entry">
            <span class="event-log-time">--:--:--</span>
            <span class="event-log-type">Waiting for events...</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      const widget = document.getElementById('set-pin');
      const widgetContainer = document.getElementById('widget-container');
      const eventLog = document.getElementById('event-log');
      const widgetTokenInput = document.getElementById('widgetToken');
      const themeButtons = document.querySelectorAll('.theme-btn');

      // Event logging function
      function logEvent(type, detail = '') {
        const time = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.className = 'event-log-entry';

        let typeClass = 'event-log-type';
        if (type.includes('success')) typeClass = 'event-log-success';
        if (type.includes('failure') || type.includes('error')) typeClass = 'event-log-failure';

        entry.innerHTML = `
          <span class="event-log-time">${time}</span>
          <span class="${typeClass}">${type}</span>
          ${detail ? `<span> - ${detail}</span>` : ''}
        `;

        // Remove "waiting" message if it exists
        const waiting = eventLog.querySelector('.event-log-entry');
        if (waiting && waiting.textContent.includes('Waiting')) {
          waiting.remove();
        }

        eventLog.prepend(entry);
      }

      // onLoad property callback (smoke test)
      widget.onLoad = (e) => {
        logEvent('onLoad callback', `instanceId=${e.detail.instanceId}, timedOut=${e.detail.timedOut}`);
      };

      // Widget event listeners
      widget.addEventListener('load', (e) => {
        const { timedOut } = e.detail;
        logEvent('load', timedOut ? 'Widget ready (timed out)' : 'Widget ready');
        console.log('Load:', e.detail);
      });

      widget.addEventListener('success', (e) => {
        logEvent('success', 'PIN set successfully!');
        console.log('Success:', e.detail);
      });

      widget.addEventListener('failure', (e) => {
        logEvent('failure', e.detail?.error || 'Unknown error');
        console.log('Failure:', e.detail);
      });

      widget.addEventListener('field-ready', (e) => {
        logEvent('field-ready', e.detail?.fieldType);
      });

      widget.addEventListener('field-validity-changed', (e) => {
        const { fieldType, isValid } = e.detail;
        logEvent('validity-changed', `${fieldType}: ${isValid ? 'valid' : 'invalid'}`);
      });

      // Token input handler
      widgetTokenInput.addEventListener('input', (e) => {
        const token = e.target.value.trim();
        if (token) {
          widget.setAttribute('token', token);
          logEvent('token-updated', token.substring(0, 20) + '...');
        }
      });

      // Theme switcher
      themeButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const theme = btn.dataset.theme;

          // Update active state
          themeButtons.forEach((b) => b.classList.remove('active'));
          btn.classList.add('active');

          // Update widget theme
          widget.setAttribute('theme', theme);

          // Update container background for night-shift
          if (theme === 'night-shift') {
            widgetContainer.classList.add('night-shift-preview');
          } else {
            widgetContainer.classList.remove('night-shift-preview');
          }

          logEvent('theme-changed', theme);
        });
      });

      // Initial log
      logEvent('initialized', 'Set PIN widget loaded');
    </script>
  </body>
</html>
