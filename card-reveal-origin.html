<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card Reveal – Standalone CORS Test</title>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon" />
    <!--
      Point this at the real deployed GCS bundle to test CORS.
      No polyfills needed — the bundle is fully self-contained.
    -->
    <script type="module" src="https://assets-staging.synctera.com/widgets/card-reveal/v1.0.0/index.js"></script>
    <style>
      * { box-sizing: border-box; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        background: #f5f5f5;
      }
      .container {
        max-width: 620px;
        margin: 0 auto;
        padding: 24px 16px;
      }
      h1 { color: #1f2937; margin: 0 0 4px; }
      .subtitle { color: #6b7280; margin: 0 0 24px; font-size: 14px; }
      .card {
        background: #fff;
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }
      .card h3 { margin: 0 0 12px; color: #1f2937; }

      label { display: block; font-weight: 600; font-size: 14px; color: #374151; margin-bottom: 6px; }
      input[type="text"] {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
      }
      input[type="text"]:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
      input[type="text"]::placeholder { color: #9ca3af; font-family: -apple-system, sans-serif; }

      .pill-group { display: flex; gap: 6px; margin-top: 4px; flex-wrap: wrap; }
      .pill {
        padding: 6px 14px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.15s;
      }
      .pill:hover { border-color: #3b82f6; }
      .pill.active { border-color: #3b82f6; background: #eff6ff; color: #3b82f6; font-weight: 600; }

      .field-row { margin-bottom: 14px; }
      .field-row:last-child { margin-bottom: 0; }

      .widget-area {
        display: flex;
        justify-content: center;
        padding: 8px 0;
        min-height: 240px;
        align-items: center;
      }

      .btn-row { display: flex; gap: 8px; justify-content: center; margin-top: 12px; }
      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.15s;
      }
      .btn-primary { background: #3b82f6; color: #fff; }
      .btn-primary:hover { background: #2563eb; }
      .btn-secondary { background: #e5e7eb; color: #374151; }
      .btn-secondary:hover { background: #d1d5db; }

      .status-bar {
        font-size: 12px;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        padding: 10px 14px;
        background: #f9fafb;
        border-radius: 8px;
        color: #6b7280;
        min-height: 38px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
      .dot-idle { background: #d1d5db; }
      .dot-ok { background: #10b981; }
      .dot-err { background: #ef4444; }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Card Reveal – Standalone Test</h1>
      <p class="subtitle">
        Open this file from any origin to verify the deployed GCS bundle loads and CORS is working.
      </p>

      <div class="card">
        <h3>Configuration</h3>

        <div class="field-row">
          <label for="tokenInput">Widget Token</label>
          <input
            type="text"
            id="tokenInput"
            placeholder="Paste token from GET /v2/cards/{id}/widget_token?widget_type=REVEAL"
          />
        </div>

        <div class="field-row">
          <label>Environment</label>
          <div class="pill-group" data-group="env">
            <button class="pill active" data-val="dev">Dev</button>
            <button class="pill" data-val="staging">Staging</button>
            <button class="pill" data-val="sandbox">Sandbox</button>
            <button class="pill" data-val="production">Production</button>
          </div>
        </div>

        <div class="field-row">
          <label>Card Form</label>
          <div class="pill-group" data-group="card-form">
            <button class="pill active" data-val="physical">Physical</button>
            <button class="pill" data-val="virtual">Virtual</button>
          </div>
        </div>

        <div class="field-row">
          <label>Card Network</label>
          <div class="pill-group" data-group="card-network">
            <button class="pill active" data-val="visa">Visa</button>
            <button class="pill" data-val="mastercard">Mastercard</button>
          </div>
        </div>

        <div class="field-row">
          <label>Theme</label>
          <div class="pill-group" data-group="theme">
            <button class="pill active" data-val="default">Default</button>
            <button class="pill" data-val="night-shift">Night Shift</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Widget</h3>
        <div class="widget-area" id="widgetArea">
          <card-reveal-widget
            id="widget"
            token=""
            env="dev"
            theme="default"
            card-side="front"
            card-form="physical"
            card-type="DEBIT"
            last-four="4242"
            emboss-name="JOHN DOE"
            card-network="visa"
            show-toggle
            toggle-label="Reveal Card Details"
          ></card-reveal-widget>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" id="flipBtn">Flip Card</button>
          <button class="btn btn-secondary" id="refreshBtn">Refresh</button>
        </div>
      </div>

      <div class="card">
        <h3>Status</h3>
        <div class="status-bar" id="status">
          <span class="dot dot-idle"></span>
          <span>Waiting for token…</span>
        </div>
      </div>
    </div>

    <script>
      const widget = document.getElementById('widget');
      const widgetArea = document.getElementById('widgetArea');
      const tokenInput = document.getElementById('tokenInput');
      const status = document.getElementById('status');

      function setStatus(type, msg) {
        const dotClass = type === 'ok' ? 'dot-ok' : type === 'err' ? 'dot-err' : 'dot-idle';
        const time = new Date().toLocaleTimeString();
        status.innerHTML = `<span class="dot ${dotClass}"></span><span>${time} — ${msg}</span>`;
      }

      // Token input
      tokenInput.addEventListener('input', () => {
        const val = tokenInput.value.trim();
        widget.setAttribute('token', val);
        if (val) {
          setStatus('idle', 'Token set — toggle reveal to fetch card details');
        }
      });

      // Pill group click delegation
      document.querySelectorAll('.pill-group').forEach((group) => {
        group.addEventListener('click', (e) => {
          const pill = e.target.closest('.pill');
          if (!pill) return;
          group.querySelectorAll('.pill').forEach((p) => p.classList.remove('active'));
          pill.classList.add('active');

          const attr = group.dataset.group;
          const val = pill.dataset.val;
          widget.setAttribute(attr, val);

          if (attr === 'theme') {
            widgetArea.style.background = val === 'night-shift'
              ? 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)'
              : '';
            widgetArea.style.borderRadius = val === 'night-shift' ? '12px' : '';
          }
        });
      });

      // Buttons
      document.getElementById('flipBtn').addEventListener('click', () => widget.toggleCardSide());
      document.getElementById('refreshBtn').addEventListener('click', () => {
        widget.refresh();
        setStatus('idle', 'Refreshing…');
      });

      // Widget events
      widget.addEventListener('success', () => setStatus('ok', 'Card details revealed'));
      widget.addEventListener('failure', (e) => setStatus('err', e.detail?.error || 'Reveal failed'));
    </script>
  </body>
</html>